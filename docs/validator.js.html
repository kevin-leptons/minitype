<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>validator.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DataSize.html">DataSize</a><ul class='methods'><li data-type='method' style='display: none;'><a href="DataSize.html#.fromBigInt">fromBigInt</a></li><li data-type='method' style='display: none;'><a href="DataSize.html#.fromBytes">fromBytes</a></li><li data-type='method' style='display: none;'><a href="DataSize.html#.fromMegabytes">fromMegabytes</a></li><li data-type='method' style='display: none;'><a href="DataSize.html#.fromString">fromString</a></li><li data-type='method' style='display: none;'><a href="DataSize.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="DataSize.html#format">format</a></li><li data-type='method' style='display: none;'><a href="DataSize.html#toNumber">toNumber</a></li></ul></li><li><a href="Float64.html">Float64</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Float64.html#.fromNumber">fromNumber</a></li></ul></li><li><a href="LowerTidyString.html">LowerTidyString</a><ul class='methods'><li data-type='method' style='display: none;'><a href="LowerTidyString.html#.fromString">fromString</a></li><li data-type='method' style='display: none;'><a href="LowerTidyString.html#value">value</a></li></ul></li><li><a href="PInt.html">PInt</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PInt.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="PInt.html#.fromNumber">fromNumber</a></li></ul></li><li><a href="PInt64.html">PInt64</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PInt64.html#.fromBigInt">fromBigInt</a></li><li data-type='method' style='display: none;'><a href="PInt64.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="PInt64.html#.fromHeximal">fromHeximal</a></li><li data-type='method' style='display: none;'><a href="PInt64.html#.fromNumber">fromNumber</a></li></ul></li><li><a href="Result.html">Result</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Result.html#.error">error</a></li><li data-type='method' style='display: none;'><a href="Result.html#.ok">ok</a></li><li data-type='method' style='display: none;'><a href="Result.html#.typeError">typeError</a></li><li data-type='method' style='display: none;'><a href="Result.html#open">open</a></li></ul></li><li><a href="TidyString.html">TidyString</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TidyString.html#.fromString">fromString</a></li><li data-type='method' style='display: none;'><a href="TidyString.html#value">value</a></li></ul></li><li><a href="Timespan.html">Timespan</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Timespan.html#.elapsedTime">elapsedTime</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#.fromMiliseconds">fromMiliseconds</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#.fromMinutes">fromMinutes</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#.fromSeconds">fromSeconds</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#addMiliseconds">addMiliseconds</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#addSeconds">addSeconds</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#format">format</a></li><li data-type='method' style='display: none;'><a href="Timespan.html#toBigInt">toBigInt</a></li></ul></li><li><a href="Timestamp.html">Timestamp</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Timestamp.html#.fromHeximalSeconds">fromHeximalSeconds</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#.fromMiliseconds">fromMiliseconds</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#.fromSeconds">fromSeconds</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#.now">now</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#add">add</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#gt">gt</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#isFuture">isFuture</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#isPast">isPast</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#isPresentOrPast">isPresentOrPast</a></li><li data-type='method' style='display: none;'><a href="Timestamp.html#lt">lt</a></li></ul></li><li><a href="UFloat64.html">UFloat64</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UFloat64.html#.fromNumber">fromNumber</a></li></ul></li><li><a href="UInt.html">UInt</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UInt.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="UInt.html#.fromHeximal">fromHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt.html#.fromNumber">fromNumber</a></li><li data-type='method' style='display: none;'><a href="UInt.html#add">add</a></li><li data-type='method' style='display: none;'><a href="UInt.html#div">div</a></li><li data-type='method' style='display: none;'><a href="UInt.html#eq">eq</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format">format</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format2">format2</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format3">format3</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format4">format4</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format5">format5</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format6">format6</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format7">format7</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format8">format8</a></li><li data-type='method' style='display: none;'><a href="UInt.html#format9">format9</a></li><li data-type='method' style='display: none;'><a href="UInt.html#gt">gt</a></li><li data-type='method' style='display: none;'><a href="UInt.html#gte">gte</a></li><li data-type='method' style='display: none;'><a href="UInt.html#lt">lt</a></li><li data-type='method' style='display: none;'><a href="UInt.html#lte">lte</a></li><li data-type='method' style='display: none;'><a href="UInt.html#mul">mul</a></li><li data-type='method' style='display: none;'><a href="UInt.html#sub">sub</a></li></ul></li><li><a href="UInt16.html">UInt16</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UInt16.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="UInt16.html#.fromHeximal">fromHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt16.html#.fromNumber">fromNumber</a></li></ul></li><li><a href="UInt32.html">UInt32</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UInt32.html#format">format</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format2">format2</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format3">format3</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format4">format4</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format5">format5</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format6">format6</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format7">format7</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format8">format8</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#format9">format9</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#.fromHeximal">fromHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt32.html#.fromNumber">fromNumber</a></li></ul></li><li><a href="UInt64.html">UInt64</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UInt64.html#format">format</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format2">format2</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format3">format3</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format4">format4</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format5">format5</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format6">format6</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format7">format7</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format8">format8</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#format9">format9</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#add">add</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#addNumber">addNumber</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#addPInt64">addPInt64</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#div">div</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#gt">gt</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#gte">gte</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#lt">lt</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#lte">lte</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#mul">mul</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#sub">sub</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#subNumber">subNumber</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#toHeximal">toHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#.fromBigInt">fromBigInt</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#.fromHeximal">fromHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#.fromNumber">fromNumber</a></li><li data-type='method' style='display: none;'><a href="UInt64.html#.min">min</a></li></ul></li><li><a href="UInt256.html">UInt256</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UInt256.html#toHeximal">toHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt256.html#.fromBigInt">fromBigInt</a></li><li data-type='method' style='display: none;'><a href="UInt256.html#.fromDecimal">fromDecimal</a></li><li data-type='method' style='display: none;'><a href="UInt256.html#.fromHeximal">fromHeximal</a></li><li data-type='method' style='display: none;'><a href="UInt256.html#.fromNumber">fromNumber</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#Decimal">Decimal</a></li><li><a href="global.html#decimalToPInt">decimalToPInt</a></li><li><a href="global.html#decimalToUInt">decimalToUInt</a></li><li><a href="global.html#Formatter">Formatter</a></li><li><a href="global.html#FORMATTER">FORMATTER</a></li><li><a href="global.html#FORMATTER_2">FORMATTER_2</a></li><li><a href="global.html#FORMATTER_3">FORMATTER_3</a></li><li><a href="global.html#FORMATTER_4">FORMATTER_4</a></li><li><a href="global.html#FORMATTER_5">FORMATTER_5</a></li><li><a href="global.html#FORMATTER_6">FORMATTER_6</a></li><li><a href="global.html#FORMATTER_7">FORMATTER_7</a></li><li><a href="global.html#FORMATTER_8">FORMATTER_8</a></li><li><a href="global.html#FORMATTER_9">FORMATTER_9</a></li><li><a href="global.html#Heximal">Heximal</a></li><li><a href="global.html#heximalToUInt">heximalToUInt</a></li><li><a href="global.html#inspectDecimal">inspectDecimal</a></li><li><a href="global.html#inspectHeximal">inspectHeximal</a></li><li><a href="global.html#isDecimalGreater">isDecimalGreater</a></li><li><a href="global.html#isNonEmptyString">isNonEmptyString</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#mapArray">mapArray</a></li><li><a href="global.html#mapObject">mapObject</a></li><li><a href="global.html#MapObjectAction">MapObjectAction</a></li><li><a href="global.html#toLowerTidyString">toLowerTidyString</a></li><li><a href="global.html#toTidyUIntDecimal">toTidyUIntDecimal</a></li><li><a href="global.html#validateArray">validateArray</a></li><li><a href="global.html#validateArrayItems">validateArrayItems</a></li><li><a href="global.html#validateAttributes">validateAttributes</a></li><li><a href="global.html#validateBigUInt">validateBigUInt</a></li><li><a href="global.html#validateInstance">validateInstance</a></li><li><a href="global.html#validateInstanceMap">validateInstanceMap</a></li><li><a href="global.html#validateObject">validateObject</a></li><li><a href="global.html#validatePInt">validatePInt</a></li><li><a href="global.html#validateUInt">validateUInt</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">validator.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

const {Result} = require('./result')
const {Decimal, Heximal} = require('./primitive')

/**
 * For native number and restrict by unsigned integer, 53 bits.
 *
 * @param {number} value
 * @return {Result&lt;TypeError, undefined>}
 */
function validateUInt(value) {
    if (!Number.isInteger(value) || value &lt; 0) {
        return Result.typeError('expect a unsigned integer')
    }
    if (value > Number.MAX_SAFE_INTEGER) {
        return Result.typeError('overflow unsigned integer 53 bits')
    }
    return Result.ok()
}

/**
 * For native number and restrict by positive integer, 53 bits.
 *
 * @param {number} value
 * @return {Result&lt;TypeError, undefined>}
 */
function validatePInt(value) {
    if (!Number.isInteger(value) || value &lt;= 0) {
        return Result.typeError('expect a positive integer')
    }
    if (value > Number.MAX_SAFE_INTEGER) {
        return Result.typeError('overflow positive integer 53 bits')
    }
    return Result.ok()
}

/**
 *
 * @param {number} value
 * @return {Result&lt;TypeError, undefined>}
 */
function validateBigUInt(value) {
    if (typeof(value) === 'bigint' || value &lt; 0) {
        return Result.typeError('expect a big unsigned integer')
    }
    return Result.ok()
}

/**
 * @private
 * @param {Heximal} value
 * @return {Result&lt;TypeError, undefined>}
 */
function validateHeximal(value) {
    return /^0x[a-fA-F0-9]+$/.test(value)
        ? Result.ok()
        : Result.typeError('expect a heximal')
}

/**
 * @private
 * @param {Decimal} value
 * @return {Result&lt;TypeError, undefined>}
 */
function validateUIntDecimal(value) {
    return /^[0-9]+$/.test(value)
        ? Result.ok()
        : Result.typeError('expect a unsigned integer from decimal')
}

/**
 *
 * @param {object} value
 * @return {Result&lt;TypeError, undefined>}
 */
function validateObject(value) {
    return (typeof(value) !== 'object') || (value === null)
        ? Result.typeError('expect an object')
        : Result.ok()
}

/**
 *
 * @param {Array} value
 * @param {number} minSize
 * @param {maxSize} maxSize
 * @return {Result&lt;TypeError, undefined>}
 */
function validateArray(value, minSize, maxSize) {
    if (!Array.isArray(value)) {
        return Result.typeError('expect an array')
    }
    if (minSize !== undefined &amp;&amp; value.length &lt; minSize) {
        return Result.typeError(`expect ${minSize} items at least`)
    }
    if (maxSize !== undefined &amp;&amp; value.length > maxSize) {
        return Result.typeError(`expect ${maxSize} items at most`)
    }
    return Result.ok()
}

/**
 *
 * @param {Array} value
 * @param {Function | string} type
 * @param {number | undefined} minSize
 * @param {number | undefined} maxSize
 * @return {Result&lt;TypeError, undefined>}
 * @example
 * // Validate list of numbers.
 * let n = [1, 2, 3]
 * validateArrayItems(n, 'number').open()
 *
 * // Validate list of buffers.
 * let b = [
 *     Buffer.from([1]),
 *     Buffer.from([2])
 * ]
 * validateArrayItems(b, Buffer).open()
 */
function validateArrayItems(
    value, type, minSize = undefined, maxSize = undefined
) {
    let r1 = validateArray(value)
    if (r1.error) {
        return r1
    }
    if (minSize !== undefined &amp;&amp; value.length &lt; minSize) {
        return Result.typeError(`expect ${minSize} items at least`)
    }
    if (maxSize !== undefined &amp;&amp; value.length > maxSize) {
        return Result.typeError(`expect ${maxSize} items at most`)
    }
    for (let i = 0; i &lt; value.length; ++i) {
        let r2 = validateInstance(value[i], type)
        if (r2.error) {
            return Result.typeError(`[${i}]: ${r2.error.message}`)
        }
    }
    return Result.ok()
}

/**
 * Return `true` if input is an object and not `null`.
 *
 * @param {object} value
 * @return {boolean}
 */
function isObject(value) {
    return typeof(value) === 'object' &amp;&amp; value !== null
}

/**
 *
 * @param {string} value
 * @return {boolean}
 */
function isNonEmptyString(value) {
    return typeof(value) === 'string' &amp;&amp; value.length > 0
}

/**
 *
 * @param {any} value
 * @param {Function | string} type
 * @return {Result&lt;TypeError, undefined>}
 * @example
 * validateInstance(null, 'any')
 * validateInstance('foo', 'string')
 * validateInstance(true, 'boolean')
 * validateInstance(1, 'number')
 * validateInstance([1, 2], Array)
 */
function validateInstance(value, type) {
    if (type === 'any') {
        return Result.ok()
    }
    else if (typeof(type) === 'string') {
        return typeof(value) === type
            ? Result.ok()
            : Result.typeError(`expect type ${type}`)
    }
    else {
        return (value instanceof type)
            ? Result.ok()
            : Result.typeError(`expect ${type.name}`)
    }
}

/**
 * Validate object attributes by type.
 *
 * @param {object} value - Object for validations.
 * @param {Array&lt;string, Function  | string, boolean>} specs - List of
 * attribute specifications. `specs[][0]` is attribute name. `specs[][1]` is a
 * type, or a string, string mean primitive type such as `any`, `object`,
 * `number`, `boolean`. `specs[][2]` make optional attribute by `true`,
 * default is `false`.
 * @param {boolean} strict - If there are attributes which is not specify then
 * retun error.
 * @return {Result&lt;TypeError, undefined>}
 * @example
 * let object = {
 *     one: 1,
 *     two: 'two',
 *     buffer: Buffer.from([])
 * }
 * let result = validateInstanceMap(object, [
 *     ['one', 'number'],
 *     ['two', 'string'],
 *     ['buffer', Buffer]
 * ])
 */
function validateInstanceMap(value, specs, strict = true) {
    let r1 = validateObject(value)
    if (r1.error) {
        return r1
    }
    if (strict) {
        let attributes = specs.map(spec => spec[0])
        let r2 = validateAttributes(value, attributes)
        if (r2.error) {
            return r2
        }
    }
    for (let [name, type, optional] of specs) {
        let attributeValue = value[name]
        if (optional &amp;&amp; attributeValue === undefined) {
            continue
        }
        let r3 = validateInstance(attributeValue, type, name)
        if (r3.error) {
            return Result.typeError(name + ': ' + r3.error.message)
        }
    }
    return Result.ok()
}

/**
 * Check an object has not accepted attribute names.
 *
 * @param {object} value
 * @param {Array&lt;string>} acceptedAttributes
 * @return {Result&lt;TypeError, undefined>}
 */
function validateAttributes(value, acceptedAttributes = []) {
    let objectAttributes = Object.getOwnPropertyNames(value)
    let acceptedAttributeSet = new Set(acceptedAttributes)
    for (let name of objectAttributes) {
        if (!acceptedAttributeSet.has(name)) {
            return Result.typeError(`${name}: not accepted attribute name`)
        }
    }
    return Result.ok()
}

/**
 * **Tags:** `NO_INPUT_VALIDATION`.
 *
 * @param {Heximal} value
 * @return {Array&lt;number, number | undefined>} `[0]` is quantities of
 * significant heximal digits, `[1]` is first significant digit.
 * @example
 * inspectHeximal('0x00fbcd') // => [4, 'f']
 */
function inspectHeximal(value) {
    for (let i = 2; i &lt; value.length; ++i) {
        if (value[i] !== '0') {
            return [value.length - i, value[i]]
        }
    }
    return [0, undefined]
}

/**
 * **Tags:** `NO_INPUT_VALIDATION`.
 *
 * @param {Decimal} value
 * @return {Array&lt;number, number | undefined>} - `[0]` is quantities of
 * significant digits, `[1]` is first significant digit.
 * @example
 * inspectDecimal('00123') // => [3, '1']
 */
function inspectDecimal(value) {
    for (let i = 0; i &lt; value.length; ++i) {
        if (value[i] !== '0') {
            return [value.length - i, value[i]]
        }
    }
    return [0, undefined]
}

module.exports = {
    validateUInt,
    validatePInt,
    validateBigUInt,
    validateHeximal,
    validateUIntDecimal,
    validateObject,
    validateArray,
    validateArrayItems,
    inspectHeximal,
    inspectDecimal,
    isObject,
    isNonEmptyString,
    validateInstance,
    validateInstanceMap,
    validateAttributes
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> on Fri Mar 11 2022 14:19:03 GMT+0700 (Indochina Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
